{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/auth/session.ts"],"sourcesContent":["import { jwtVerify, SignJWT } from \"jose\";\nimport type { AuthUser } from \"@/lib/auth/types\";\n\nconst SESSION_COOKIE_NAME = \"dashboard_session\";\nconst SESSION_DURATION_SECONDS = 60 * 60 * 12;\n\nfunction getJwtSecret(): Uint8Array {\n  const secret = process.env.AUTH_JWT_SECRET;\n  if (!secret) {\n    throw new Error(\"Falta AUTH_JWT_SECRET en variables de entorno.\");\n  }\n\n  return new TextEncoder().encode(secret);\n}\n\nexport function getSessionCookieName(): string {\n  return SESSION_COOKIE_NAME;\n}\n\nexport async function createSessionToken(user: AuthUser): Promise<string> {\n  const secret = getJwtSecret();\n\n  return new SignJWT({ email: user.email, source: user.source })\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setSubject(user.email)\n    .setIssuedAt()\n    .setExpirationTime(`${SESSION_DURATION_SECONDS}s`)\n    .sign(secret);\n}\n\nexport async function verifySessionToken(token: string): Promise<AuthUser | null> {\n  try {\n    const secret = getJwtSecret();\n    const { payload } = await jwtVerify(token, secret);\n\n    const email = typeof payload.email === \"string\" ? payload.email : null;\n    const source = payload.source === \"ldap\" || payload.source === \"local\" ? payload.source : null;\n\n    if (!email || !source) {\n      return null;\n    }\n\n    return { email, source };\n  } catch {\n    return null;\n  }\n}\n\nexport function getSessionMaxAge(): number {\n  return SESSION_DURATION_SECONDS;\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;;AAGA,MAAM,sBAAsB;AAC5B,MAAM,2BAA2B,KAAK,KAAK;AAE3C,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;IAC1C,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAEO,SAAS;IACd,OAAO;AACT;AAEO,eAAe,mBAAmB,IAAc;IACrD,MAAM,SAAS;IAEf,OAAO,IAAI,wKAAO,CAAC;QAAE,OAAO,KAAK,KAAK;QAAE,QAAQ,KAAK,MAAM;IAAC,GACzD,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,UAAU,CAAC,KAAK,KAAK,EACrB,WAAW,GACX,iBAAiB,CAAC,GAAG,yBAAyB,CAAC,CAAC,EAChD,IAAI,CAAC;AACV;AAEO,eAAe,mBAAmB,KAAa;IACpD,IAAI;QACF,MAAM,SAAS;QACf,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,4KAAS,EAAC,OAAO;QAE3C,MAAM,QAAQ,OAAO,QAAQ,KAAK,KAAK,WAAW,QAAQ,KAAK,GAAG;QAClE,MAAM,SAAS,QAAQ,MAAM,KAAK,UAAU,QAAQ,MAAM,KAAK,UAAU,QAAQ,MAAM,GAAG;QAE1F,IAAI,CAAC,SAAS,CAAC,QAAQ;YACrB,OAAO;QACT;QAEA,OAAO;YAAE;YAAO;QAAO;IACzB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS;IACd,OAAO;AACT"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\nimport { getSessionCookieName, verifySessionToken } from \"@/lib/auth/session\";\n\nconst PUBLIC_ROUTES = [\n  \"/api/auth/login\",\n  \"/api/auth/logout\",\n  \"/api/auth/session\",\n  \"/api/health-awx\",\n  \"/api/health-summary\",\n];\n\nfunction isPublicPath(pathname: string): boolean {\n  return PUBLIC_ROUTES.some((route) => pathname === route || pathname.startsWith(`${route}/`));\n}\n\nexport async function middleware(request: NextRequest) {\n  const { pathname, search } = request.nextUrl;\n\n  if (pathname.startsWith(\"/_next\") || pathname.startsWith(\"/favicon\") || pathname.startsWith(\"/public\")) {\n    return NextResponse.next();\n  }\n\n  if (isPublicPath(pathname)) {\n    return NextResponse.next();\n  }\n\n  const token = request.cookies.get(getSessionCookieName())?.value;\n  if (!token) {\n    if (pathname === \"/login\") {\n      return NextResponse.next();\n    }\n\n    if (pathname.startsWith(\"/api/\")) {\n      return NextResponse.json({ error: \"No autenticado.\" }, { status: 401 });\n    }\n\n    const loginUrl = new URL(\"/login\", request.url);\n    loginUrl.searchParams.set(\"next\", `${pathname}${search}`);\n    return NextResponse.redirect(loginUrl);\n  }\n\n  const session = await verifySessionToken(token);\n  if (!session) {\n    if (pathname === \"/login\") {\n      return NextResponse.next();\n    }\n\n    if (pathname.startsWith(\"/api/\")) {\n      return NextResponse.json({ error: \"Sesión inválida.\" }, { status: 401 });\n    }\n\n    const loginUrl = new URL(\"/login\", request.url);\n    loginUrl.searchParams.set(\"next\", `${pathname}${search}`);\n    return NextResponse.redirect(loginUrl);\n  }\n\n  if (pathname === \"/login\") {\n    return NextResponse.redirect(new URL(\"/\", request.url));\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\"/((?!.*\\\\..*).*)\"],\n};"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEA,MAAM,gBAAgB;IACpB;IACA;IACA;IACA;IACA;CACD;AAED,SAAS,aAAa,QAAgB;IACpC,OAAO,cAAc,IAAI,CAAC,CAAC,QAAU,aAAa,SAAS,SAAS,UAAU,CAAC,GAAG,MAAM,CAAC,CAAC;AAC5F;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,QAAQ,OAAO;IAE5C,IAAI,SAAS,UAAU,CAAC,aAAa,SAAS,UAAU,CAAC,eAAe,SAAS,UAAU,CAAC,YAAY;QACtG,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,IAAI,aAAa,WAAW;QAC1B,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,IAAA,6JAAoB,MAAK;IAC3D,IAAI,CAAC,OAAO;QACV,IAAI,aAAa,UAAU;YACzB,OAAO,gMAAY,CAAC,IAAI;QAC1B;QAEA,IAAI,SAAS,UAAU,CAAC,UAAU;YAChC,OAAO,gMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,QAAQ,GAAG,WAAW,QAAQ;QACxD,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,MAAM,UAAU,MAAM,IAAA,2JAAkB,EAAC;IACzC,IAAI,CAAC,SAAS;QACZ,IAAI,aAAa,UAAU;YACzB,OAAO,gMAAY,CAAC,IAAI;QAC1B;QAEA,IAAI,SAAS,UAAU,CAAC,UAAU;YAChC,OAAO,gMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,QAAQ,GAAG,WAAW,QAAQ;QACxD,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,IAAI,aAAa,UAAU;QACzB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAmB;AAC/B"}}]
}