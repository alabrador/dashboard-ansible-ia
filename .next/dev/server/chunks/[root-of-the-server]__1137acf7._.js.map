{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/alabrador/dashboard-ansible-ia/src/app/api/news/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\ntype NewsTopic = \"general\" | \"politica\" | \"economia\" | \"tecnologia\" | \"deportes\";\n\ntype NewsItem = {\n  title: string;\n  link: string;\n  source?: string;\n  pubDate?: string;\n};\n\nconst topicQueries: Record<NewsTopic, string> = {\n  general: \"España últimas noticias\",\n  politica: \"España política\",\n  economia: \"España economía\",\n  tecnologia: \"España tecnología\",\n  deportes: \"España deportes\",\n};\n\nfunction isNewsTopic(value: string): value is NewsTopic {\n  return value in topicQueries;\n}\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replace(/<!\\[CDATA\\[(.*?)\\]\\]>/g, \"$1\")\n    .replace(/&amp;/g, \"&\")\n    .replace(/&quot;/g, '\"')\n    .replace(/&#39;/g, \"'\")\n    .replace(/&lt;/g, \"<\")\n    .replace(/&gt;/g, \">\")\n    .trim();\n}\n\nfunction extractTag(content: string, tag: string): string {\n  const regex = new RegExp(`<${tag}[^>]*>([\\\\s\\\\S]*?)</${tag}>`, \"i\");\n  const match = content.match(regex);\n  return match ? decodeEntities(match[1]) : \"\";\n}\n\nfunction parseRssItems(xml: string): NewsItem[] {\n  const items: NewsItem[] = [];\n  const itemRegex = /<item>([\\s\\S]*?)<\\/item>/g;\n  let match = itemRegex.exec(xml);\n\n  while (match && items.length < 5) {\n    const content = match[1];\n    const title = extractTag(content, \"title\");\n    const link = extractTag(content, \"link\");\n    const source = extractTag(content, \"source\") || undefined;\n    const pubDate = extractTag(content, \"pubDate\") || undefined;\n\n    if (title && link) {\n      items.push({ title, link, source, pubDate });\n    }\n\n    match = itemRegex.exec(xml);\n  }\n\n  return items;\n}\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const rawTopic = searchParams.get(\"topic\") ?? \"general\";\n  const topic: NewsTopic = isNewsTopic(rawTopic) ? rawTopic : \"general\";\n\n  const query = topicQueries[topic];\n  const rssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(query)}&hl=es&gl=ES&ceid=ES:es`;\n\n  try {\n    const response = await fetch(rssUrl, {\n      headers: {\n        \"User-Agent\": \"dashboard-ansible-ia/1.0\",\n      },\n      next: { revalidate: 300 },\n    });\n\n    if (!response.ok) {\n      return NextResponse.json({ error: \"No se pudieron obtener noticias.\" }, { status: 502 });\n    }\n\n    const xml = await response.text();\n    const items = parseRssItems(xml);\n\n    if (!items.length) {\n      return NextResponse.json({ error: \"No se encontraron titulares para este tema.\" }, { status: 404 });\n    }\n\n    return NextResponse.json({ topic, items });\n  } catch {\n    return NextResponse.json({ error: \"Error al consultar noticias.\" }, { status: 500 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAWA,MAAM,eAA0C;IAC9C,SAAS;IACT,UAAU;IACV,UAAU;IACV,YAAY;IACZ,UAAU;AACZ;AAEA,SAAS,YAAY,KAAa;IAChC,OAAO,SAAS;AAClB;AAEA,SAAS,eAAe,KAAa;IACnC,OAAO,MACJ,OAAO,CAAC,0BAA0B,MAClC,OAAO,CAAC,UAAU,KAClB,OAAO,CAAC,WAAW,KACnB,OAAO,CAAC,UAAU,KAClB,OAAO,CAAC,SAAS,KACjB,OAAO,CAAC,SAAS,KACjB,IAAI;AACT;AAEA,SAAS,WAAW,OAAe,EAAE,GAAW;IAC9C,MAAM,QAAQ,IAAI,OAAO,CAAC,CAAC,EAAE,IAAI,oBAAoB,EAAE,IAAI,CAAC,CAAC,EAAE;IAC/D,MAAM,QAAQ,QAAQ,KAAK,CAAC;IAC5B,OAAO,QAAQ,eAAe,KAAK,CAAC,EAAE,IAAI;AAC5C;AAEA,SAAS,cAAc,GAAW;IAChC,MAAM,QAAoB,EAAE;IAC5B,MAAM,YAAY;IAClB,IAAI,QAAQ,UAAU,IAAI,CAAC;IAE3B,MAAO,SAAS,MAAM,MAAM,GAAG,EAAG;QAChC,MAAM,UAAU,KAAK,CAAC,EAAE;QACxB,MAAM,QAAQ,WAAW,SAAS;QAClC,MAAM,OAAO,WAAW,SAAS;QACjC,MAAM,SAAS,WAAW,SAAS,aAAa;QAChD,MAAM,UAAU,WAAW,SAAS,cAAc;QAElD,IAAI,SAAS,MAAM;YACjB,MAAM,IAAI,CAAC;gBAAE;gBAAO;gBAAM;gBAAQ;YAAQ;QAC5C;QAEA,QAAQ,UAAU,IAAI,CAAC;IACzB;IAEA,OAAO;AACT;AAEO,eAAe,IAAI,OAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,WAAW,aAAa,GAAG,CAAC,YAAY;IAC9C,MAAM,QAAmB,YAAY,YAAY,WAAW;IAE5D,MAAM,QAAQ,YAAY,CAAC,MAAM;IACjC,MAAM,SAAS,CAAC,qCAAqC,EAAE,mBAAmB,OAAO,uBAAuB,CAAC;IAEzG,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,QAAQ;YACnC,SAAS;gBACP,cAAc;YAChB;YACA,MAAM;gBAAE,YAAY;YAAI;QAC1B;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmC,GAAG;gBAAE,QAAQ;YAAI;QACxF;QAEA,MAAM,MAAM,MAAM,SAAS,IAAI;QAC/B,MAAM,QAAQ,cAAc;QAE5B,IAAI,CAAC,MAAM,MAAM,EAAE;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8C,GAAG;gBAAE,QAAQ;YAAI;QACnG;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAO;QAAM;IAC1C,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACF"}}]
}