{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/alabrador/dashboard-ansible-ia/src/lib/auth/session.ts"],"sourcesContent":["import { jwtVerify, SignJWT } from \"jose\";\nimport type { AuthUser } from \"@/lib/auth/types\";\n\nconst SESSION_COOKIE_NAME = \"dashboard_session\";\nconst SESSION_DURATION_SECONDS = 60 * 60 * 12;\n\nfunction getJwtSecret(): Uint8Array {\n  const secret = process.env.AUTH_JWT_SECRET;\n  if (!secret) {\n    throw new Error(\"Falta AUTH_JWT_SECRET en variables de entorno.\");\n  }\n\n  return new TextEncoder().encode(secret);\n}\n\nexport function getSessionCookieName(): string {\n  return SESSION_COOKIE_NAME;\n}\n\nexport async function createSessionToken(user: AuthUser): Promise<string> {\n  const secret = getJwtSecret();\n\n  return new SignJWT({ email: user.email, source: user.source })\n    .setProtectedHeader({ alg: \"HS256\" })\n    .setSubject(user.email)\n    .setIssuedAt()\n    .setExpirationTime(`${SESSION_DURATION_SECONDS}s`)\n    .sign(secret);\n}\n\nexport async function verifySessionToken(token: string): Promise<AuthUser | null> {\n  try {\n    const secret = getJwtSecret();\n    const { payload } = await jwtVerify(token, secret);\n\n    const email = typeof payload.email === \"string\" ? payload.email : null;\n    const source = payload.source === \"ldap\" || payload.source === \"local\" ? payload.source : null;\n\n    if (!email || !source) {\n      return null;\n    }\n\n    return { email, source };\n  } catch {\n    return null;\n  }\n}\n\nexport function getSessionMaxAge(): number {\n  return SESSION_DURATION_SECONDS;\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;;AAGA,MAAM,sBAAsB;AAC5B,MAAM,2BAA2B,KAAK,KAAK;AAE3C,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;IAC1C,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAI,cAAc,MAAM,CAAC;AAClC;AAEO,SAAS;IACd,OAAO;AACT;AAEO,eAAe,mBAAmB,IAAc;IACrD,MAAM,SAAS;IAEf,OAAO,IAAI,kKAAO,CAAC;QAAE,OAAO,KAAK,KAAK;QAAE,QAAQ,KAAK,MAAM;IAAC,GACzD,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,UAAU,CAAC,KAAK,KAAK,EACrB,WAAW,GACX,iBAAiB,CAAC,GAAG,yBAAyB,CAAC,CAAC,EAChD,IAAI,CAAC;AACV;AAEO,eAAe,mBAAmB,KAAa;IACpD,IAAI;QACF,MAAM,SAAS;QACf,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAE3C,MAAM,QAAQ,OAAO,QAAQ,KAAK,KAAK,WAAW,QAAQ,KAAK,GAAG;QAClE,MAAM,SAAS,QAAQ,MAAM,KAAK,UAAU,QAAQ,MAAM,KAAK,UAAU,QAAQ,MAAM,GAAG;QAE1F,IAAI,CAAC,SAAS,CAAC,QAAQ;YACrB,OAAO;QACT;QAEA,OAAO;YAAE;YAAO;QAAO;IACzB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS;IACd,OAAO;AACT"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///home/alabrador/dashboard-ansible-ia/src/app/api/auth/session/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { cookies } from \"next/headers\";\nimport { getSessionCookieName, verifySessionToken } from \"@/lib/auth/session\";\n\nexport async function GET() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get(getSessionCookieName())?.value;\n\n  if (!token) {\n    return NextResponse.json({ authenticated: false }, { status: 401 });\n  }\n\n  const user = await verifySessionToken(token);\n  if (!user) {\n    return NextResponse.json({ authenticated: false }, { status: 401 });\n  }\n\n  return NextResponse.json({ authenticated: true, user });\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,IAAA,uJAAoB,MAAK;IAEvD,IAAI,CAAC,OAAO;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,eAAe;QAAM,GAAG;YAAE,QAAQ;QAAI;IACnE;IAEA,MAAM,OAAO,MAAM,IAAA,qJAAkB,EAAC;IACtC,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,eAAe;QAAM,GAAG;YAAE,QAAQ;QAAI;IACnE;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,eAAe;QAAM;IAAK;AACvD"}}]
}