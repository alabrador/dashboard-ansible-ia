{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/alabrador/dashboard-ansible-ia/src/app/api/weather/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\ntype WeatherPayload = {\n  daily?: {\n    weather_code?: number[];\n    precipitation_probability_max?: number[];\n    temperature_2m_max?: number[];\n  };\n};\n\nfunction buildTip(weatherCode: number, rainProbability: number, maxTemp: number) {\n  const isRainLikely = rainProbability >= 45 || [51, 53, 55, 61, 63, 65, 80, 81, 82, 95].includes(weatherCode);\n  const isSunny = [0, 1].includes(weatherCode) && rainProbability < 30;\n\n  if (isRainLikely) {\n    return `Clima: hoy puede llover (${rainProbability}%).`;\n  }\n\n  if (isSunny) {\n    return `Clima: hoy pinta sol, máx ${Math.round(maxTemp)}°C.`;\n  }\n\n  return `Clima: hoy estará variable, máx ${Math.round(maxTemp)}°C.`;\n}\n\nexport async function GET() {\n  const lat = 40.4168;\n  const lon = -3.7038;\n  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weather_code,precipitation_probability_max,temperature_2m_max&forecast_days=1&timezone=auto`;\n\n  try {\n    const response = await fetch(url, {\n      headers: {\n        \"User-Agent\": \"dashboard-ansible-ia/1.0\",\n      },\n      next: { revalidate: 1800 },\n    });\n\n    if (!response.ok) {\n      return NextResponse.json({ error: \"No se pudo obtener el clima.\" }, { status: 502 });\n    }\n\n    const payload = (await response.json()) as WeatherPayload;\n    const weatherCode = payload.daily?.weather_code?.[0];\n    const rainProbability = payload.daily?.precipitation_probability_max?.[0];\n    const maxTemp = payload.daily?.temperature_2m_max?.[0];\n\n    if (weatherCode === undefined || rainProbability === undefined || maxTemp === undefined) {\n      return NextResponse.json({ error: \"Datos de clima incompletos.\" }, { status: 502 });\n    }\n\n    return NextResponse.json({\n      city: \"Madrid\",\n      tip: buildTip(weatherCode, rainProbability, maxTemp),\n      rainProbability,\n      weatherCode,\n      maxTemp,\n    });\n  } catch {\n    return NextResponse.json({ error: \"Error al consultar el clima.\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAUA,SAAS,SAAS,WAAmB,EAAE,eAAuB,EAAE,OAAe;IAC7E,MAAM,eAAe,mBAAmB,MAAM;QAAC;QAAI;QAAI;QAAI;QAAI;QAAI;QAAI;QAAI;QAAI;QAAI;KAAG,CAAC,QAAQ,CAAC;IAChG,MAAM,UAAU;QAAC;QAAG;KAAE,CAAC,QAAQ,CAAC,gBAAgB,kBAAkB;IAElE,IAAI,cAAc;QAChB,OAAO,CAAC,yBAAyB,EAAE,gBAAgB,GAAG,CAAC;IACzD;IAEA,IAAI,SAAS;QACX,OAAO,CAAC,0BAA0B,EAAE,KAAK,KAAK,CAAC,SAAS,GAAG,CAAC;IAC9D;IAEA,OAAO,CAAC,gCAAgC,EAAE,KAAK,KAAK,CAAC,SAAS,GAAG,CAAC;AACpE;AAEO,eAAe;IACpB,MAAM,MAAM;IACZ,MAAM,MAAM,CAAC;IACb,MAAM,MAAM,CAAC,gDAAgD,EAAE,IAAI,WAAW,EAAE,IAAI,kGAAkG,CAAC;IAEvL,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,SAAS;gBACP,cAAc;YAChB;YACA,MAAM;gBAAE,YAAY;YAAK;QAC3B;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA+B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,UAAW,MAAM,SAAS,IAAI;QACpC,MAAM,cAAc,QAAQ,KAAK,EAAE,cAAc,CAAC,EAAE;QACpD,MAAM,kBAAkB,QAAQ,KAAK,EAAE,+BAA+B,CAAC,EAAE;QACzE,MAAM,UAAU,QAAQ,KAAK,EAAE,oBAAoB,CAAC,EAAE;QAEtD,IAAI,gBAAgB,aAAa,oBAAoB,aAAa,YAAY,WAAW;YACvF,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,MAAM;YACN,KAAK,SAAS,aAAa,iBAAiB;YAC5C;YACA;YACA;QACF;IACF,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACF"}}]
}